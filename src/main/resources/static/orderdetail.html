<!DOCTYPE html>
<html lang="zxx">

<head>
	<meta charset="UTF-8" />
	<meta name="description" content="Ogani Template" />
	<meta name="keywords" content="Ogani, unica, creative, html" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<meta http-equiv="X-UA-Compatible" content="ie=edge" />
	<title>LETITGO</title>

	<!-- Google Font -->
	<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200;300;400;600;900&display=swap"
		rel="stylesheet" />
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" rel="stylesheet" />

	<!-- Css Styles -->
	<link rel="stylesheet" href="css/bootstrap.min.css" type="text/css" />
	<link rel="stylesheet" href="css/font-awesome.min.css" type="text/css" />
	<link rel="stylesheet" href="css/elegant-icons.css" type="text/css" />
	<link rel="stylesheet" href="css/nice-select.css" type="text/css" />
	<link rel="stylesheet" href="css/jquery-ui.min.css" type="text/css" />
	<link rel="stylesheet" href="css/owl.carousel.min.css" type="text/css" />
	<link rel="stylesheet" href="css/slicknav.min.css" type="text/css" />
	<link rel="stylesheet" href="css/style.css" type="text/css" />
	<!-- <style>
      #checkoutgo {
        text-align: right;
          font-size: 14px !important;
          color: #ffffff !important;
          font-weight: 800 !important;
          text-transform: uppercase !important;
          display: inline-block !important;
          padding: 13px 30px 12px !important;
          background: #7fad39 !important;
          border: none !important;
       }
    </style> -->
</head>

<body>
	<!-- Page Preloder -->
	<div id="preloder">
		<div class="loader"></div>
	</div>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>


	<!-- Header Section Begin -->


	<header class="header">
		<!-- Humberger Begin -->
		<div class="humberger__menu__overlay"></div>
		<div class="humberger__menu__wrapper">
			<div class="humberger__menu__logo">
				<a href="#"><img src="/subject/src/main/webapp/img/logo.png" alt=""></a>
				 
			</div>
			<div class="humberger__menu__cart">
				<ul>
					<li><a href="./my_favorite.jsp"><i class="fa fa-heart"></i> </a></li>
					 
					<li><a href="./index.jsp"><i class="fa-solid fa-house"></i> </a></li>
					 
					<!--這個圖示用來做回首頁-->
					<li><a href="./shoping-cart.html"><i class="fa-solid fa-cart-shopping"></i> </a></li>
					 
					<!--這個圖示用來做購物車-->
					<li><a href="./listAllTicket.jsp"><i class="fa-solid fa-ticket"></i></a></li>
					 
					<!--這個圖示用來做我的票券-->
					<li><a href="./logout"><i class="fa-solid fa-person"></i></a></li>
					 
					<!--這個圖示用來做登入-->
				</ul>
				<!-- <div class="header__cart__price">item: <span>$150.00</span></div> -->
			</div>
			<div class="humberger__menu__widget">
				<!-- <div class="header__top__right__language">
                        <img src="img/language.png" alt="">
                        <div>English</div>
                        <span class="arrow_carrot-down"></span> -->
				<!-- <ul>
                            <li><a href="#">Spanis</a></li>
                            <li><a href="#">English</a></li>
                        </ul> -->
				<!-- </div> -->
				<!-- <div class="header__top__right__auth">
                        <a href="#"><i class="fa fa-user"></i> Login</a>
                    </div> -->
			</div>
			<nav class="humberger__menu__nav mobile-menu">
				<ul>
					<!-- <li class="active"><a href="./index.jsp">Home</a></li>
                        <li><a href="./shop-grid.html">Shop</a></li> -->
					<li><a href="#">會員中心</a>
						<ul class="header__menu__dropdown">
							<li><a href="./memberupdate/listAllMemberupdate.jsp">帳戶管理</a></li>
							 
							<li><a href="./orderMainFile/OrderMainFile.jsp">訂單查詢</a></li>
							 
							<li><a href="./MemberBenefits.html">會員權益</a></li>
							 
							<li><a href="./CustomerService.html">聯繫客服</a></li>
							 
							<li><a href="./FAQ.html">買家FAQ</a></li>
							 
						</ul>
					</li>
					<li><a href="#">賣家中心</a>
						<ul class="header__menu__dropdown">
							<li><a href="./seller/Order">訂單管理</a></li>
							 
							<li><a href="./seller/product.jsp">商品管理</a></li>
							 
							<li><a href="./seller/Seller">帳戶管理</a></li>
							 

						</ul>
					</li>
				</ul>
			</nav>
			<div id="mobile-menu-wrap"></div>

		</div>
		<div class="container">
			<div class="row">
				<div class="col-lg-3">
					<div class="header__logo">
						<a href="./index.jsp"><img src="./img/Frame 6.svg" alt=""></a>
						 
					</div>
				</div>
				<div class="col-lg-6">
					<nav class="header__menu">
						<ul>
							<li><a href="#">會員中心</a>
								<ul class="header__menu__dropdown">
									<li><a href="./memberupdate/listAllMemberupdate.jsp">帳戶管理</a></li>
									 
									<li><a href="./orderMainFile/OrderMainFile.jsp">訂單查詢</a></li>
									 
									<li><a href="./MemberBenefits.html">會員權益</a></li>
									 
									<li><a href="./CustomerService.html">聯繫客服</a></li>
									 
									<li><a href="./FAQ.html">買家FAQ</a></li>
									 

								</ul>
							</li>
							<li><a href="#">賣家中心</a>
								<ul class="header__menu__dropdown">
									<li><a href="./seller/Order">訂單管理</a></li>
									 
									<li><a href="./seller/product.jsp">商品管理</a></li>
									 
									<li><a href="./seller/Seller">帳戶管理</a></li>
									 

								</ul>
							</li>
						</ul>
					</nav>
				</div>
				<div class="col-lg-3">
					<div class="header__cart">
						<ul>
							<li><a href="./my_favorite.jsp"><i class="fa fa-heart"></i> </a></li>
							 
							<li><a href="./index.jsp"><i class="fa-solid fa-house"></i> </a></li>
							 
							<!--這個圖示用來做回首頁-->
							<li><a href="./shoping-cart.html"><i class="fa-solid fa-cart-shopping"></i> </a></li>
							 
							<!--這個圖示用來做購物車-->
							<li><a href="./ticket/listAllTicket.jsp"><i class="fa-solid fa-ticket"></i></a></li>
							 
							<!--這個圖示用來做我的票券-->
							<li><a href="./login.html"><i class="fa-solid fa-person"></i></a></li>
							 
							<!--這個圖示用來做登入-->
							<li><a href="./logout"><i class="fa fa-sign-out"></i></a></li>
							 
							<!--這個圖示用來做登入-->
						</ul>
						<!-- <div class="header__cart__price">item: <span>$150.00</span></div> -->
					</div>
				</div>
			</div>
			<div class="humberger__open">
				<i class="fa fa-bars"></i>
			</div>
		</div>
	</header>
	</header>
	<!-- Header Section End -->

	<!-- Breadcrumb Section Begin -->
	<section class="breadcrumb-section set-bg" data-setbg="img/breadcrumb.jpg">
		<div class="container">
			<div class="row">
				<div class="col-lg-12 text-center">
					<div class="breadcrumb__text">
						<h2>訂單已成功建立</h2>
						<div class="breadcrumb__option">
							<a href="./index.html">首頁</a>
							<span>訂單明細</span>
							<!-- 鈺婷改-以上為訂單明細大標  -->
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>
	<!-- Breadcrumb Section End -->

	<!-- Checkout Section Begin -->
	<section class="checkout spad">
		<div class="container">
			<div class="row">
				<div class="col-lg-12">
					<!-- <h6>
              <span class="icon_tag_alt"></span> Have a coupon?
              <a href="#">Click here</a> to enter your code
            </h6> -->
				</div>
			</div>
			<div class="checkout__form">
				<h4>訂單細項</h4>
				<form action="#" method="post">
					<div class="row">

						<div class="col-lg-12 col-md-10" vertical-align="middle">
							<div class="checkout__order">
								<!-- <h4>Your Order</h4> -->
								<div class="checkout__order__products">
									商品 <span>單項總價</span>
								</div>
								<!-- 鎮鴻改 -->
								<ul id="ul_order">
									<!-- <li>Vegetable’s Package <span>$75.99</span></li>
                    <li>Fresh Vegetable <span>$151.99</span></li>
                    <li>Organic Bananas <span>$53.99</span></li> -->
								</ul>

								<div class="checkout__order__subtotal">
									本次使用之購物金 <span id="golden_use_thistime"></span>
								</div>
								<!-- 鎮鴻改-以上為購物金使用金額  -->
								<!-- <div class="checkout__order__total">
                    本次使用之優惠券回饋金額 <span>20</span>
                  </div>
                  鎮鴻改-以上為本次使用優惠券回饋金額 -->
								<div class="checkout__order__total">
									總價 <span id="total_ori"></span>
								</div>
								<div class="checkout__order__total">
									結帳金額 <span id="total_checkout"></span>
								</div>

							</div>
						</div>
					</div>
			</div>
			</form>
		</div>
		</div>
		</div>
	</section>
	<!-- Checkout Section End -->

	<!-- Footer Section Begin -->
	<footer class="footer spad">
		<div class="container">
			<div class="row">
				<div class="col-lg-3 col-md-6 col-sm-6">
					<div class="footer__about">
						<div class="footer__about__logo">
							<a href="./index.jsp"><img src="./img/Frame 6.svg" alt=""></a>
						</div>
						<ul>
							<li>地址：100 台北市中正區濟南路一段321號</li>
							 
							<li>電話：02-12345678</li>
							 
							<li>Email: caldonic@gmail.com</li>
							 
						</ul>
					</div>
				</div>
				<div class="col-lg-4 col-md-6 col-sm-6 offset-lg-1">
					<div class="footer__widget">
						<h6>相關連結</h6>
						<ul class="header__menu__dropdown">
							<li><a href="./memberupdate/listAllMemberupdate.jsp">帳戶管理</a></li>
							 
							<li><a href="./orderMainFile/OrderMainFile.jsp">訂單查詢</a></li>
							 
							<li><a href="./MemberBenefits.html">會員權益</a></li>
							 
							<li><a href="./CustomerService.html">聯繫客服</a></li>
							 
							<li><a href="./FAQ.html">買家FAQ</a></li>
							 

						</ul>
						<ul class="header__menu__dropdown">
							<li><a href="./seller/Order">訂單管理</a></li>
							 
							<li><a href="./seller/product.jsp">商品管理</a></li>
							 
							<li><a href="./seller/Seller">帳戶管理</a></li>
							 
						</ul>
					</div>
				</div>
				<div class="col-lg-4 col-md-12">
					<div class="footer__widget">
						<!-- <h6>Join Our Newsletter Now</h6>
                        <p>Get E-mail updates about our latest shop and special offers.</p>
                        <form action="#">
                            <input type="text" placeholder="Enter your mail">
                            <button type="submit" class="site-btn">Subscribe</button>
                        </form> -->
						<!--                         <div class="footer__widget__social"> -->
						<!--                             <a href="#"><i class="fa fa-facebook"></i></a> -->
						<!--                             <a href="#"><i class="fa fa-instagram"></i></a> -->
						<!--                             <a href="#"><i class="fa-solid fa-envelope"></i></a> -->
						<!--                         </div> -->
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col-lg-12">
					<div class="footer__copyright">
						<div class="footer__copyright__text">
							<p>
								<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
								Copyright &copy;
								<script>document.write(new Date().getFullYear());</script> 版權所有 copyright © 2022 TEAM
								LETITGO All Rights Reserved.
								 
								<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
							</p>
						</div>
						<!-- <div class="footer__copyright__payment"><img src="img/payment-item.png" alt=""></div> -->
					</div>
				</div>
			</div>
		</div>
	</footer>
	<!-- Footer Section End -->

	<!-- Js Plugins -->
	<script src="js/jquery-3.3.1.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/jquery.nice-select.min.js"></script>
	<script src="js/jquery-ui.min.js"></script>
	<script src="js/jquery.slicknav.js"></script>
	<script src="js/mixitup.min.js"></script>
	<script src="js/owl.carousel.min.js"></script>
	<script src="js/main.js"></script>

	<script>
		$("#former_page").on("click", () => {
			document.location.href = "http://localhost:8080/subject/orderMainFile/listAllOrderMainFile.jsp";
			alert("即將回到訂單管理"); //無此行無法進行跳轉(鈺婷改)
		});
		$(function () {
			//顯示即將結帳畫面
			if (sessionStorage.getItem("memcart_data")) {
				var memcart = JSON.parse(sessionStorage.getItem("memcart_data"));
				// console.log(memcart);
				var price = 0;
				var total = 0;
				let a = JSON.parse(sessionStorage.getItem(
					"golden_valback"
				)) || null;        //與checkout不同處
				// 要設定唯一值index才能刪除memcart_data
				for (var i = 0; i < memcart.length; i++) {
					var html = "";
					html += `
            <li>${memcart[i].itemname}<span>${memcart[i].itemprice * memcart[i].itemquantity
						}</span></li>`;

					// 抓取購物車頁面時填入之購物金金額資料並且顯示
					let goldadjustmentamount = JSON.parse(sessionStorage.getItem(
						"golden_valback"
					));
					//顯示購物金於頁面
					$("#golden_use_thistime").text(goldadjustmentamount);
					//計算單項商品總價
					price = memcart[i].itemprice * memcart[i].itemquantity;
					//計算總價
					total += price;
					$("#total_ori").html(total);
					$("#ul_order").append(html);
				}
				//減掉購物金後總價
				if (a != null || a != undefined) {
					total = total - a
				};
				// console.log(total);
				$("#total_checkout").html(total);
				//結帳按鈕儲存總價至local
				$(".site-btn").on("click", () => {
					sessionStorage.setItem("cart_total", total);
				});
			}
		});

		////購物金使用按鈕連結sessionStorage
		$("#golden_use").on("click", () => {
			let golden_val = parseInt($("#golden_val").val()); //因會顯示於前端不能寫null
			let golden_valback = parseInt($("#golden_val").val());
			// sessionStorage.setItem("goldadjustmentamount", golden_val);
			//傳送購物金到後端驗證
			const url = "GoldRemainingCheck";
			fetch(url, {
				method: "POST",
				headers: {
					"content-Type": "application/json;charset=UTF-8",
				},
				body: JSON.stringify({
					goldremaining: golden_valback
					//這裡要跟java實體變數一樣
				}),
			})
				.then((res) => res.json()) //使用 .json() 解析資料
				.then((body) => {
					const msg = body.Msg;
					alert(msg);
					if (body.Msg == "購物金使用成功") {
						sessionStorage.setItem("golden_valback", golden_valback);//金額存到local
					}
					if (body.Msg == "購物金額不足") {
						sessionStorage.setItem("golden_valback", 0);//金額存到local
					}
				})
			location.reload(); //網頁重整
		});

		//// 優惠券使用按鈕連結sessionStorage
		$("#coupon_use").on("click", () => {
			let coupon_val = $("#coupon_val").val() || null;
			// sessionStorage.setItem("COUPON_NAME", coupon_val);
			//傳送couponname到後端驗證
			const url = "CouponVerify";
			const couponName = $("#coupon_val").val() || null;
			fetch(url, {
				method: "POST",
				headers: {
					"content-Type": "application/json;charset=UTF-8",
				},
				body: JSON.stringify({
					// couponserialnumber: COUPONSERIALNUMBER,
					couponname: couponName
					//這裡要跟java實體變數一樣
				}),
			})
				.then((res) => res.json()) //使用 .json() 解析資料
				.then((body) => {
					const msg = body.Msg;
					alert(msg);
					const couponnamejstr = body.couponnamejstr;  //coupon流水號
					console.log("couponname=" + couponnamejstr);
					sessionStorage.setItem("couponnamejstr", couponnamejstr);//流水號存到local
				})
		});

		////確保sessionStorage資料顯示於格內
		let goldadjustmentamount = sessionStorage.getItem(
			"golden_valback"
		);
		$("#golden_val").val(goldadjustmentamount);
		// let couponname = sessionStorage.getItem("couponnamejstr");
		// $("#coupon_val").val(couponname);


		// 結帳按鈕連結java
		$("#checkoutgo").on("click", () => {
			if (sessionStorage.getItem("couponnamejstr") == "undefined" || sessionStorage.getItem("couponnamejstr") == null) {
				var totaltotal = JSON.parse(sessionStorage.getItem("cart_total"));
				var couponnamejstr = null;
				var memcart = JSON.parse(sessionStorage.getItem("memcart_data")) || null;
				var golden_valnum = JSON.parse(sessionStorage.getItem("golden_valback")) || 0;
			}
			else {
				var totaltotal = JSON.parse(sessionStorage.getItem("cart_total"));
				var memcart = JSON.parse(sessionStorage.getItem("memcart_data")) || null;
				var couponnamejstr = JSON.parse(sessionStorage.getItem("couponnamejstr")) || null;
				var golden_valnum = JSON.parse(sessionStorage.getItem("golden_valback")) || 0;
			}
			fetch("CartServlet", {
				method: "post",
				headers: {
					"Content-Type": "application/json;charset=UTF-8",
				},
				body: JSON.stringify({
					carttotal: totaltotal,
					couponname: couponnamejstr,
					goldremaining: golden_valnum,
					cartlist: memcart,
					// memberserialnumber: Memberserialnumber.val(),
					// itemserialnumber: Itemserialnumber.val(),
					// nonmemberserialnumber: nonmemberserialnumber.val(),
					// cartitemquantity: Cartitemquantity.val(),
					// cartcreatetime: Cartcreatetime.val(),
					//這裡要跟java實體變數一樣
				}),
			})
		});
	</script>
</body>

</html>